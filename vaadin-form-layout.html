<!--
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
-->

<!--
`<vaadin-form-layout>` is a Polymer element providing configurable responsive layout for form elements.

```html
<vaadin-form-layout>
  <vaadin-text-field label="First Name"></vaadin-text-field>
  <vaadin-text-field label="Last Name"></vaadin-text-field>
  <vaadin-text-field label="Email"></vaadin-text-field>
</vaadin-form-layout>
```

The element defines a horizontal layout of 12 column units for its children,
with gaps between the columns.

## Multiple Columns

By default, all children take full width of the layout (12 column units). For
each child element, you can set a custom number of columns to span the element
on by using the `--vaadin-form-layout-colspan` custom CSS property:

```html
<vaadin-form-layout>
  <vaadin-text-field style="--vaadin-form-layout-colspan: 6;"></vaadin-text-field>
  <vaadin-text-field style="--vaadin-form-layout-colspan: 6;"></vaadin-text-field>
</vaadin-form-layout>
```

You can also insert `<br>` elements to split layout rows:

```html
<vaadin-form-layout>
  <vaadin-text-field style="--vaadin-form-layout-colspan: 4;"></vaadin-text-field>
  <br>
  <vaadin-text-field style="--vaadin-form-layout-colspan: 4;"></vaadin-text-field>
</vaadin-form-layout>
```

## Custom CSS Properties

`<vaadin-form-layout>` supports the following CSS properties:

Custom CSS property | Description | Default
---|---|---
<nobr>`--vaadin-form-layout-column-gap`</nobr> | Size of the gap (empty space) between the columns | `16px`
<nobr>`--vaadin-form-layout-label-colspan`</nobr> | Horizontal label size in number of columns | `2`

In addition, the following properties are set for the children:

Custom CSS property | Description | Default
---|---|---
<nobr>`--vaadin-form-layout-colspan`</nobr> | Horizontal size of a child element in number of columns | `12`
<nobr>`--vaadin-form-layout-label-basis`</nobr> | Width of the label part for the child input element. Matches number of columns defined in `--vaadin-form-layout-label-colspan`. | calculated
<nobr>`--vaadin-form-layout-label-gap`</nobr> | Size of the gap between the label and the input box parts of the child input element. Matches `--vaadin-form-layout-column-gap`. | calculated

@element vaadin-form-layout
@demo demo/index.html
-->

<link rel="import" href="../polymer/polymer.html">

<dom-module id="vaadin-form-layout">
  <template>
    <style>
      :host {
        display: block;

        /* API */
        --vaadin-form-layout-column-gap: 16px;
        --vaadin-form-layout-label-colspan: 2;

        /* private */
        --vaadin-form-layout-columns: 6;

        /* API, read-only computed */
        --column: calc(100% / var(--vaadin-form-layout-columns));
      }

      #layout {
        display: flex;
        flex-wrap: wrap;
        margin: 0 calc(-1/2 * var(--vaadin-form-layout-column-gap));
      }

      #layout ::slotted(*) {
        box-sizing: border-box;
        width: 100%;
        padding-left: calc(var(--vaadin-form-layout-column-gap) / 2);
        padding-right: calc(var(--vaadin-form-layout-column-gap) / 2);

        /* API, read-only computed */
        --vaadin-form-layout-label-basis: calc(var(--vaadin-form-layout-label-colspan) * var(--column) - var(--vaadin-form-layout-label-gap));
        --vaadin-form-layout-label-gap: var(--vaadin-form-layout-column-gap);
      }

      #layout ::slotted(br) {
        display: block;
        content: '';
        flex: 1 1 100%;
        width: 9999px; /* Firefox :-( */
      }

      #resizeSensor {
        width: 100%;
        height: 100%;
        position: absolute;
        left: 0;
        top: 0;
        border: none;
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
      }
    </style>
    <div id="layout">
      <slot></slot>
    </div>
    <iframe id="resizeSensor"></iframe>
  </template>

  <script>
    class VaadinFormLayoutElement extends Polymer.Element {
      static get is() {
        return 'vaadin-form-layout';
      }

      static get properties() {
        return {
        };
      }

      ready() {
        super.ready();

        this.$.resizeSensor.contentWindow.addEventListener('resize', () => this._updateSize());
        Polymer.RenderStatus.afterNextRender(this, this._updateSize);
      }

      _updateSize() {
        let columns = 6 * (1 + Math.floor(this.$.layout.clientWidth / 768));
        this.updateStyles({'--vaadin-form-layout-columns': columns});

        let columnBasis = this.$.layout.clientWidth / columns;
        this.updateStyles({'--column': columnBasis + 'px'});
      }
    }

    customElements.define(VaadinFormLayoutElement.is, VaadinFormLayoutElement);
  </script>
</dom-module>
