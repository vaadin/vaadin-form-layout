<!--
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
-->

<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../vaadin-themable-mixin/vaadin-themable-mixin.html">

<dom-module id="vaadin-form-item">
  <template>
    <style>
      :host {
        display: inline-flex;
        flex-direction: row;
        align-items: baseline;

        /* CSS API for host */
        --vaadin-form-item-label-width: 8em;
        --vaadin-form-item-label-gap: 1em;
      }

      :host([label-on-top]) {
        flex-direction: column;
        align-items: stretch;
      }

      #label {
        width: var(--vaadin-form-item-label-width);
        flex: 0 0 auto;
      }

      :host([label-on-top]) #label {
        width: auto;
      }

      #gap {
        width: var(--vaadin-form-item-label-gap);
        flex: 0 0 auto;
      }

      #content {
        flex: 1 1 auto;
      }

      #content ::slotted(.full-width) {
        box-sizing: border-box;
        width: 100%;
        min-width: 0;
      }
    </style>
    <div id="label" part="label" on-click="_onLabelClick">
      <slot name="label"></slot>
    </div>
    <div id="gap"></div>
    <div id="content">
      <slot id="contentSlot"></slot>
    </div>
  </template>

  <script>
    (function() {
      /**
       * `<vaadin-form-item>` is a Polymer element providing labelled form item wrapper
       * for using inside `<vaadin-form-layout>`.
       *
       * `<vaadin-form-item>` accepts any number of children as the input content,
       * and also has a separate named `label` slot:
       *
       * ```html
       * <vaadin-form-item>
       *   <label slot="label">Label aside</label>
       *   <input>
       * </vaadin-form-item>
       * ```
       *
       * By default, the `label` slot content is displayed aside of the input content.
       * When `label-on-top` attribute is set, the `label` slot content
       * is displayed on top:
       *
       * ```html
       * <vaadin-form-item label-on-top>
       *   <label slot="label">Label on top</label>
       *   <input>
       * </vaadin-form-item>
       * ```
       *
       * When used as a child of a `<vaadin-form-layout>`, the `label-on-top` attribute
       * is tiggered automatically by the parent `<vaadin-form-layout>`, depending on
       * its width and responsive behavior.
       *
       * ### Inputs Width
       *
       * By default, `<vaadin-form-item>` does not manipulate the width of the slotted
       * input elements. Optionally you can stretch the child input element to fill
       * the avaiable width for the input content by applying the `full-width` classname:
       *
       * ```html
       * <vaadin-form-item>
       *   <label slot="label">Label</label>
       *   <input class="full-width">
       * </vaadin-form-item>
       * ```
       *
       * ### Custom CSS Properties Reference
       *
       * The following custom CSS properties are available on the `<vaadin-form-item>`
       * element:
       *
       * Custom CSS property | Description | Default
       * ---|---|---
       * `--vaadin-form-item-label-width` | Width of the label column when the labels are aside | `8em`
       * `--vaadin-form-item-label-gap` | Length of the gap between the label column and the input column when the labels are aside | `1em`
       *
       * @memberof Vaadin
       * @mixes Vaadin.ThemableMixin
       * @demo demo/index.html
       */
      class FormItemElement extends Vaadin.ThemableMixin(Polymer.Element) {
        static get is() {
          return 'vaadin-form-item';
        }

        static get properties() {
          return {
          };
        }

        _onLabelClick(e) {
          // No `Array.prototype.find` in MSIE :-(
          const arrayFind = Array.prototype.find || function(callback, thisArg) {
            const array = Object(this); // eslint-disable-line no-invalid-this
            for (let i = 0; i < array.length; i++) {
              if (callback.call(thisArg, array[i], i, array)) {
                return array[i];
              }
            }
          };
          const firstContentElementChild = arrayFind.call(
              this.$.contentSlot.assignedNodes(),
              (e) => e.nodeType === Node.ELEMENT_NODE
          );
          if (firstContentElementChild) {
            firstContentElementChild.focus();
            firstContentElementChild.click();
          }
        }
      }

      customElements.define(FormItemElement.is, FormItemElement);

      /**
       * @namespace Vaadin
       */
      window.Vaadin = window.Vaadin || {};
      Vaadin.FormItemElement = FormItemElement;
    })();
  </script>
</dom-module>
